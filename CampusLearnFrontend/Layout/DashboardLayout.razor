@inherits LayoutComponentBase
@inject NavigationManager NavManager

<div class="layout-container">
    <!-- Top Navbar -->
    <header class="top-navbar">
        <div class="navbar-left">
            <img src="images/WhatsApp Image 2025-10-01 at 21.35.51_943b1ffc.jpg" alt="Logo" class="navbar-logo" />
            <h3 class="navbar-title">CampusLearn</h3>
        </div>
        <button class="burger" @onclick="ToggleMenu">
            <i class="fas fa-bars"></i>
        </button>
    </header>

    <!-- Side Menu -->
            <nav class="@($"side-menu {(isMenuOpen ? "open" : "collapsed")}")">
                <ul>
                    <!-- Dashboard -->
                    <li> <button class="menu-btn" @onclick="@(() => NavigateTo("/dashboard"))"> <i class="fas fa-chart-line icon"></i> <span class="label">Dashboard</span> </button> </li>
            <!-- Profile -->
            <li>
                <button class="menu-btn collapsible" @onclick="ToggleProfileSubmenu">
                    <i class="fas fa-user icon"></i>
                    <span class="label">Profile</span>
                    @if (isMenuOpen)
                    {
                        <i class="fas fa-chevron-down ml-auto" style="@($"transition: transform 0.3s; transform: rotate({(isProfileOpen ? 180 : 0)}deg);")"></i>
                    }
                </button>
                @if (isProfileOpen && isMenuOpen)
                {
                    <ul class="submenu">
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateToProfile())">
                                <i class="fas fa-id-badge icon-sub"></i>
                                <span class="label">View Profile</span>
                            </button>
                        </li>
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/student-profile"))">
                                <i class="fas fa-edit icon-sub"></i>
                                <span class="label">Edit Profile</span>
                            </button>
                        </li>
                    </ul>
                }
            </li>

            <!-- Subjects -->
            <li>
                <button class="menu-btn collapsible" @onclick="ToggleSubjectsSubmenu">
                    <i class="fas fa-book icon"></i>
                    <span class="label">Subjects</span>
                    @if (isMenuOpen)
                    {
                        <i class="fas fa-chevron-down ml-auto" style="@($"transition: transform 0.3s; transform: rotate({(isSubjectsOpen ? 180 : 0)}deg);")"></i>
                    }
                </button>
                @if (isSubjectsOpen && isMenuOpen)
                {
                    <ul class="submenu">
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/topics"))">
                                <i class="fas fa-book-open icon-sub"></i>
                                <span class="label">Topics</span>
                            </button>
                        </li>
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/tutors"))">
                                <i class="fas fa-chalkboard-teacher icon-sub"></i>
                                <span class="label">Tutors</span>
                            </button>
                        </li>
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/forum"))">
                                <i class="fas fa-comments icon-sub"></i>
                                <span class="label">Discussions</span>
                            </button>
                        </li>
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/resources"))">
                                <i class="fas fa-file-alt icon-sub"></i>
                                <span class="label">Resources</span>
                            </button>
                        </li>
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/chatbot"))">
                                <i class="fas fa-flask icon-sub"></i>
                                <span class="label">ClaraTea</span>
                            </button>
                        </li>
                    </ul>
                }
            </li>

            <!-- Peers -->
            <li>
                <button class="menu-btn collapsible" @onclick="TogglePeersSubmenu">
                    <i class="fas fa-users icon"></i>
                    <span class="label">Peers</span>
                    @if (isMenuOpen)
                    {
                        <i class="fas fa-chevron-down ml-auto" style="@($"transition: transform 0.3s; transform: rotate({(isPeersOpen ? 180 : 0)}deg);")"></i>
                    }
                </button>
                @if (isPeersOpen && isMenuOpen)
                {
                    <ul class="submenu">
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/student-profile"))">
                                <i class="fas fa-user-graduate icon-sub"></i>
                                <span class="label">Student</span>
                            </button>
                        </li>
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/tutors"))">
                                <i class="fas fa-chalkboard-teacher icon-sub"></i>
                                <span class="label">Tutor</span>
                            </button>
                        </li>
                    </ul>
                }
            </li>

            <!-- Messages -->
            <li>
                <button class="menu-btn" @onclick="@(() => NavigateTo("/messages"))">
                    <i class="fas fa-envelope icon"></i>
                    <span class="label">Messages</span>
                </button>
            </li>

            <!-- Admin (only if IsAdmin) -->
            @if (IsAdmin)
            {
                <li>
                    <button class="menu-btn collapsible" @onclick="ToggleAdminSubmenu">
                        <i class="fas fa-user-shield icon"></i>
                        <span class="label">Admin</span>
                        @if (isMenuOpen)
                        {
                            <i class="fas fa-chevron-down ml-auto" style="@($"transition: transform 0.3s; transform: rotate({(isAdminOpen ? 180 : 0)}deg);")"></i>
                        }
                    </button>
                    @if (isAdminOpen && isMenuOpen)
                    {
                        <ul class="submenu">
                            <li>
                                <button class="menu-btn" @onclick="@(() => NavigateTo("/admin-profile"))">
                                    <i class="fas fa-user-plus icon-sub"></i>
                                    <span class="label">Tutor Applications</span>
                                </button>
                            </li>
                            <li>
                                <button class="menu-btn" @onclick="@(() => NavigateTo("/reports"))">
                                    <i class="fas fa-file-alt icon-sub"></i>
                                    <span class="label">Reports</span>
                                </button>
                            </li>
                            <li>
                                <button class="menu-btn" @onclick="@(() => NavigateTo("/analytics"))">
                                    <i class="fas fa-chart-pie icon-sub"></i>
                                    <span class="label">Analytics</span>
                                </button>
                            </li>
                            <li>
                                <button class="menu-btn" @onclick="@(() => NavigateTo("/subjects"))">
                                    <i class="fas fa-book icon-sub"></i>
                                    <span class="label">Manage Subjects & Topics</span>
                                </button>
                            </li>
                        </ul>
                    }
                </li>
            }

            <!-- Extra items (keep as-is) -->
            <li>
                <button class="menu-btn collapsible" @onclick="ToggleLearning">
                    <i class="fas fa-graduation-cap icon"></i>
                    <span class="label">Learning</span>
                    @if (isMenuOpen)
                    {
                        <i class="fas fa-chevron-down ml-auto" style="@($"transition: transform 0.3s; transform: rotate({(isLearningOpen ? 180 : 0)}deg);")"></i>
                    }
                </button>
                @if (isLearningOpen && isMenuOpen)
                {
                    <ul class="submenu">
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/resources"))">
                                <i class="fas fa-file-alt icon-sub"></i>
                                <span class="label">Resources</span>
                            </button>
                        </li>
                        <li>
                            <button class="menu-btn" @onclick="@(() => NavigateTo("/topics"))">
                                <i class="fas fa-book-open icon-sub"></i>
                                <span class="label">Topics</span>
                            </button>
                        </li>
                    </ul>
                }
            </li>

            <li>
                <button class="menu-btn" @onclick="@(() => NavigateTo("/chatbot"))">
                    <i class="fas fa-robot icon"></i>
                    <span class="label">AI Chatbot</span>
                </button>
            </li>

            <li>
                <button class="menu-btn logout" @onclick="@(() => NavigateTo("/"))">
                    <i class="fas fa-sign-out-alt icon"></i>
                    <span class="label">Logout</span>
                </button>
            </li>
        </ul>
    </nav>


    <!-- Main content -->
    <main class="main-content">
        @Body
    </main>
</div>

<style>
.layout-container { display:flex; min-height:100vh; background:linear-gradient(135deg, #eef2ff, #bfdbfe); }

/* Top navbar */
.top-navbar { position:fixed; top:0; left:0; width:100%; height:60px; background:rgba(255,255,255,0.85); backdrop-filter:blur(8px); display:flex; justify-content:space-between; align-items:center; padding:0 16px; box-shadow:0 2px 6px rgba(0,0,0,0.05); z-index:1002; }
.navbar-left { display:flex; align-items:center; gap:10px; }
.navbar-logo { height:36px; }
.navbar-title { font-size:1.3rem; font-weight:700; margin:0; }
.burger { font-size:1.5rem; background:none; border:none; cursor:pointer; }

/* Side Menu */
.side-menu 
{
        position: fixed;
        top: 60px;
        right: 0;
        height: calc(100% - 60px);
        background: linear-gradient(180deg, #e0f2fe, #bfdbfe);
        overflow-y: auto; /* ✅ allow vertical scrolling */
        overflow-x: hidden; /* optional, hide horizontal scroll */
        transition: width 0.3s ease;
        display: flex;
        flex-direction: column;
        padding-top: 20px;
        box-shadow: -2px 0 6px rgba(0,0,0,0.05);
        z-index: 1001;
}
.side-menu.collapsed { width:60px; }
.side-menu.open { width:180px; }
.side-menu ul { list-style:none; padding:0; margin:0; }
.menu-btn { display:flex; align-items:center; gap:12px; background:none; border:none; color:#1e293b; font-size:1rem; padding:12px 16px; width:100%; text-align:left; cursor:pointer; transition:background 0.2s ease; }
.menu-btn:hover { background:rgba(255,255,255,0.6); }
.menu-btn.logout { color:#dc2626; }
.menu-btn .icon { font-size:1.2rem; min-width:24px; text-align:center; }
.side-menu.collapsed .label { display:none; }

/* Submenu */
.submenu { padding-left:24px; display:flex; flex-direction:column; }
.icon-sub { font-size:0.9rem; min-width:20px; }
.side-menu.collapsed .fa-chevron-down { display:none; }

/* Main content */
.main-content { flex:1; margin-top:60px; margin-right:60px; padding:20px; transition:margin-right 0.3s ease; }
.side-menu.open ~ .main-content { margin-right:190px; }
</style>

@code {
    private bool isMenuOpen = false;
    private bool isProfileOpen = false;
    private bool isSubjectsOpen = false;
    private bool isPeersOpen = false;
    private bool isAdminOpen = false;
    private bool isLearningOpen = false;

    private string LoggedInUserEmail = "1111@admin.belgiumcampus.ac.za";
    private bool IsAdmin => LoggedInUserEmail.EndsWith("@admin.belgiumcampus.ac.za");

    private void ToggleMenu() => isMenuOpen = !isMenuOpen;
    private void ToggleProfileSubmenu() => isProfileOpen = !isProfileOpen;
    private void ToggleSubjectsSubmenu() => isSubjectsOpen = !isSubjectsOpen;
    private void TogglePeersSubmenu() => isPeersOpen = !isPeersOpen;
    private void ToggleAdminSubmenu() => isAdminOpen = !isAdminOpen;
    private void ToggleLearning() => isLearningOpen = !isLearningOpen;

    private void NavigateTo(string url) => NavManager.NavigateTo(url);

    private void NavigateToProfile()
    {
        if (string.IsNullOrWhiteSpace(LoggedInUserEmail))
        {
            NavManager.NavigateTo("/login");
            return;
        }
        if (LoggedInUserEmail.EndsWith("@admin.belgiumcampus.ac.za"))
            NavManager.NavigateTo("/admin-profile");
        else if (LoggedInUserEmail.EndsWith("@tutor.belgiumcampus.ac.za"))
            NavManager.NavigateTo("/tutor-profile");
        else
            NavManager.NavigateTo("/student-profile");
    }
}
